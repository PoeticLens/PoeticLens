<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libby Nessworthy - Poetry Archive</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: url('https://cdn.leonardo.ai/users/550ed1ad-9fba-4d78-b281-b013ab57e8f0/generations/0cb726c8-5c8b-409d-b036-12ae2f9e570a/Leonardo_Phoenix_10_create_a_serene_and_vibrant_webpage_banner_3.jpg?w=512') center/cover fixed, rgba(232, 245, 232, 0.9);
            min-height: 100vh;
            color: #2d5016;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(45, 80, 22, 0.3), rgba(90, 138, 58, 0.2));
            z-index: -1;
        }

        /* Navigation */
        nav {
            background: rgba(13, 79, 92, 0.9);
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            color: #7dd3fc;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-badge {
            width: 80px;
            height: 80px;
            background-image: url('https://cdn.leonardo.ai/users/550ed1ad-9fba-4d78-b281-b013ab57e8f0/generations/2bde07ae-f0b0-464b-9833-23982ee2f426/variations/Default_Design_a_natureinspired_badge_logo_featuring_the_styli_1_2bde07ae-f0b0-464b-9833-23982ee2f426_0.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: randomSpin 8s ease-in-out infinite;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .logo-badge:hover {
            animation: continuousSpin 1s linear infinite;
        }

        @keyframes randomSpin {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(0deg); }
            30% { transform: rotate(360deg); }
            50% { transform: rotate(360deg); }
            75% { transform: rotate(360deg); }
            80% { transform: rotate(720deg); }
            100% { transform: rotate(720deg); }
        }

        @keyframes continuousSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-btn {
            background: none;
            border: 2px solid #7dd3fc;
            color: #7dd3fc;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-btn:hover {
            background: #7dd3fc;
            color: #0d4f5c;
            transform: translateY(-2px);
        }

        .nav-btn-leaf {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 30px;
            height: 30px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0;
            transform: scale(0.5) rotate(-45deg);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }

        .nav-btn:hover .nav-btn-leaf {
            opacity: 1;
            transform: scale(1) rotate(0deg);
            animation: leafCycle 1.5s ease-in-out infinite;
        }

        @keyframes leafCycle {
            0%, 33% {
                background-image: url('https://cdn.leonardo.ai/users/550ed1ad-9fba-4d78-b281-b013ab57e8f0/generations/90eebbc0-16d8-416a-a0d5-b523d08a7f5c/variations/Default_A_vibrantly_colored_animated_leaf_with_intricate_veins_3_90eebbc0-16d8-416a-a0d5-b523d08a7f5c_0.png');
                transform: scale(1) rotate(0deg);
            }
            34%, 66% {
                background-image: url('https://cdn.leonardo.ai/users/550ed1ad-9fba-4d78-b281-b013ab57e8f0/generations/bfdb5525-80be-42a3-a089-8adf683db74a/variations/Default_A_vibrantly_colored_animated_leaf_with_intricate_veins_2_bfdb5525-80be-42a3-a089-8adf683db74a_0.png');
                transform: scale(1.1) rotate(120deg);
            }
            67%, 100% {
                background-image: url('https://cdn.leonardo.ai/users/550ed1ad-9fba-4d78-b281-b013ab57e8f0/generations/55365eb0-13d6-4127-92ae-43879ce919b3/variations/Default_A_vibrantly_colored_animated_leaf_with_intricate_veins_1_55365eb0-13d6-4127-92ae-43879ce919b3_0.png');
                transform: scale(1) rotate(240deg);
            }
        }

        /* Announcement bar */
        .announcement {
            background: #7dd3fc;
            color: #0d4f5c;
            text-align: center;
            padding: 0.5rem;
            margin-top: 70px;
            font-weight: bold;
        }

        /* Main content */
        .main-content {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            min-height: calc(100vh - 120px);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        }

        /* Page styles */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Introduction Page */
        .intro-page {
            text-align: center;
            padding: 4rem 2rem;
        }

        .intro-title {
            font-size: 3rem;
            color: #0d4f5c;
            margin-bottom: 1rem;
            animation: fadeInUp 1s ease;
        }

        .intro-subtitle {
            font-size: 1.5rem;
            color: #0891b2;
            margin-bottom: 2rem;
            animation: fadeInUp 1s ease 0.3s both;
        }

        .intro-text {
            font-size: 1.2rem;
            line-height: 1.8;
            max-width: 800px;
            margin: 0 auto 3rem;
            animation: fadeInUp 1s ease 0.6s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Book styles */
        .book-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 600px;
            perspective: 1000px;
        }

        .book {
            width: 400px;
            height: 600px;
            position: relative;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .book-cover {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('https://octaneseating.com/blog/wp-content/uploads/2023/12/Pull-Up-Leather.png') center/cover, #8B4513;
            border-radius: 8px;
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.3),
                inset 0 0 20px rgba(0,0,0,0.2),
                inset -5px 0 15px rgba(0,0,0,0.1);
            transform-origin: left;
            transition: transform 0.8s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #FFD700;
            font-size: 1.5rem;
            text-align: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            z-index: 2;
        }

        .book.open .book-cover {
            transform: rotateY(-180deg);
        }

        .book-cover-content {
            position: relative;
            z-index: 3;
            transition: opacity 0.3s ease;
        }

        .book.open .book-cover-content {
            opacity: 0;
        }

        .book-cover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(139, 69, 19, 0.6) 0%,
                rgba(160, 82, 45, 0.4) 25%,
                rgba(139, 69, 19, 0.7) 50%,
                rgba(101, 67, 33, 0.6) 75%,
                rgba(139, 69, 19, 0.7) 100%
            );
            z-index: 1;
        }

        .book-cover > * {
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-family: 'Times New Roman', serif;
            font-weight: bold;
        }

        .book-cover h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }

        .book-cover h3 {
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .book-cover p {
            font-size: 0.9rem;
            opacity: 0.8;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .book-pages {
            position: absolute;
            width: 95%;
            height: 95%;
            background: #f9f9f9;
            border-radius: 0 8px 8px 0;
            left: 5%;
            top: 2.5%;
            padding: 2rem;
            overflow-y: auto;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease 0.3s;
            z-index: 1;
        }

        .book.open .book-pages {
            opacity: 1;
            visibility: visible;
        }

        .poetry-entry {
            margin-bottom: 3rem;
            padding: 1.5rem;
            border-left: 4px solid #7dd3fc;
            background: rgba(125, 211, 252, 0.1);
            border-radius: 0 8px 8px 0;
        }

        .poetry-title {
            font-size: 1.3rem;
            color: #0d4f5c;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .poetry-content {
            line-height: 1.8;
            font-style: italic;
            white-space: pre-line;
        }

        .poetry-author {
            text-align: right;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #0891b2;
        }

        .poetry-image {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin: 1rem 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Forms */
        .form-container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #0d4f5c;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #7dd3fc;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            height: 150px;
            resize: vertical;
        }

        .submit-btn {
            background: #7dd3fc;
            color: #0d4f5c;
            padding: 1rem 2rem;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .submit-btn:hover {
            background: #0891b2;
            transform: translateY(-2px);
        }

        .submit-btn-leaf {
            position: absolute;
            top: -10px;
            right: 10px;
            width: 25px;
            height: 25px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0;
            transform: scale(0.5) rotate(-45deg);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }

        .submit-btn:hover .submit-btn-leaf {
            opacity: 1;
            transform: scale(1) rotate(0deg);
            animation: leafCycle 1.5s ease-in-out infinite;
        }

        /* Image preview styles */
        .image-preview {
            margin-top: 1rem;
            text-align: center;
        }

        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            object-fit: cover;
        }

        .remove-image-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 0.5rem;
            transition: all 0.3s ease;
        }

        .remove-image-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        /* Shop styles */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            padding: 2rem 0;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .shop-item:hover {
            transform: translateY(-5px);
        }

        .shop-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .shop-item h3 {
            color: #0d4f5c;
            margin-bottom: 0.5rem;
        }

        .shop-item .price {
            font-size: 1.2rem;
            color: #7dd3fc;
            font-weight: bold;
            margin: 0.5rem 0;
        }

        /* Admin styles - Professional Dark Theme */
        .admin-panel {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 0;
            margin: 2rem 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
            color: #e0e0e0;
        }

        .admin-header {
            background: linear-gradient(135deg, #263238, #37474f);
            color: #ffffff;
            padding: 2rem;
            text-align: center;
            border-bottom: 2px solid #455a64;
        }

        .admin-header h2 {
            margin: 0;
            font-size: 2rem;
            color: #ffffff;
        }

        .admin-header p {
            color: #b0bec5;
            margin: 0.5rem 0 0 0;
        }

        .admin-tabs {
            display: flex;
            background: #2c2c2c;
            border-bottom: 1px solid #404040;
            overflow-x: auto;
        }

        .admin-tab {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 1rem;
            color: #b0b0b0;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            min-width: 150px;
            border-right: 1px solid #404040;
        }

        .admin-tab:hover {
            background: #3c3c3c;
            color: #ffffff;
        }

        .admin-tab.active {
            background: #1976d2;
            color: #ffffff;
            font-weight: bold;
        }

        .admin-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #2196f3;
        }

        .admin-tab-content {
            padding: 2rem;
            display: none;
            max-height: 70vh;
            overflow-y: auto;
            background: #1e1e1e;
        }

        .admin-tab-content.active {
            display: block;
        }

        .admin-form-section {
            background: #262626;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-form-section h4 {
            color: #ffffff;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-bottom: 1px solid #404040;
            padding-bottom: 0.5rem;
        }

        .admin-form-section .form-group {
            margin-bottom: 1rem;
        }

        .admin-form-section .form-group label {
            color: #b0b0b0;
            font-weight: normal;
            font-size: 0.9rem;
        }

        .admin-form-section .form-group input,
        .admin-form-section .form-group textarea {
            background: #333333;
            border: 1px solid #555555;
            color: #ffffff;
            padding: 0.8rem;
        }

        .admin-form-section .form-group input:focus,
        .admin-form-section .form-group textarea:focus {
            border-color: #2196f3;
            outline: none;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
        }

        .admin-form-section .submit-btn {
            background: #1976d2;
            color: #ffffff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .admin-form-section .submit-btn:hover {
            background: #1565c0;
            transform: none;
        }

        .admin-items-grid {
            display: grid;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .admin-item-card {
            background: #2a2a2a;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .admin-item-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-color: #555555;
        }

        .admin-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .admin-item-title {
            font-weight: bold;
            color: #ffffff;
            margin: 0;
            font-size: 1.1rem;
        }

        .admin-item-author {
            color: #b0b0b0;
            font-style: italic;
            font-size: 0.85rem;
        }

        .admin-item-content {
            margin: 0.5rem 0;
            color: #d0d0d0;
            max-height: 100px;
            overflow: hidden;
            position: relative;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .admin-item-image {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            float: right;
            margin-left: 1rem;
            border: 1px solid #404040;
        }

        .admin-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .admin-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .admin-btn.edit {
            background: #ff9800;
            color: #ffffff;
        }

        .admin-btn.edit:hover {
            background: #f57c00;
        }

        .admin-btn.delete {
            background: #f44336;
            color: #ffffff;
        }

        .admin-btn.delete:hover {
            background: #d32f2f;
        }

        .admin-btn.save {
            background: #4caf50;
            color: #ffffff;
        }

        .admin-btn.save:hover {
            background: #388e3c;
        }

        .admin-btn.cancel {
            background: #757575;
            color: #ffffff;
        }

        .admin-btn.cancel:hover {
            background: #616161;
        }

        .admin-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .edit-form {
            background: #1a1a1a;
            border: 1px solid #555555;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
            display: none;
        }

        .edit-form.active {
            display: block;
        }

        .edit-form h4 {
            color: #ffffff;
            margin-bottom: 1rem;
            border-bottom: 1px solid #404040;
            padding-bottom: 0.5rem;
        }

        .edit-form .form-group {
            margin-bottom: 1rem;
        }

        .edit-form .form-group label {
            color: #b0b0b0;
            font-size: 0.9rem;
        }

        .edit-form .form-group input,
        .edit-form .form-group textarea {
            background: #333333;
            border: 1px solid #555555;
            color: #ffffff;
            padding: 0.8rem;
            width: 100%;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #1976d2, #2196f3);
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #1565c0;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .logout-section {
            border-top: 1px solid #404040;
            padding: 1.5rem 2rem;
            background: #262626;
            text-align: center;
        }

        .logout-section .submit-btn {
            background: #f44336;
            color: #ffffff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .logout-section .submit-btn:hover {
            background: #d32f2f;
            transform: none;
        }

        .tab-icon {
            margin-right: 0.5rem;
        }

        .cooldown-message {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            color: #856404;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
        }

        /* Security notification */
        .security-notice {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            color: #856404;
            padding: 0.8rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
            text-align: center;
        }

        /* Floating elements */
        .floating-elements {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: -1;
        }

        .floating-leaf {
            position: absolute;
            width: 60px;
            height: 60px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: float 8s ease-in-out infinite;
            opacity: 0.7;
        }

        .floating-leaf.leaf1 {
            background-image: url('https://cdn.leonardo.ai/users/550ed1ad-9fba-4d78-b281-b013ab57e8f0/generations/90eebbc0-16d8-416a-a0d5-b523d08a7f5c/variations/Default_A_vibrantly_colored_animated_leaf_with_intricate_veins_3_90eebbc0-16d8-416a-a0d5-b523d08a7f5c_0.png');
        }

        .floating-leaf.leaf2 {
            background-image: url('https://cdn.leonardo.ai/users/550ed1ad-9fba-4d78-b281-b013ab57e8f0/generations/bfdb5525-80be-42a3-a089-8adf683db74a/variations/Default_A_vibrantly_colored_animated_leaf_with_intricate_veins_2_bfdb5525-80be-42a3-a089-8adf683db74a_0.png');
        }

        .floating-leaf.leaf3 {
            background-image: url('https://cdn.leonardo.ai/users/550ed1ad-9fba-4d78-b281-b013ab57e8f0/generations/55365eb0-13d6-4127-92ae-43879ce919b3/variations/Default_A_vibrantly_colored_animated_leaf_with_intricate_veins_1_55365eb0-13d6-4127-92ae-43879ce919b3_0.png');
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg) scale(1); 
                opacity: 0.7;
            }
            25% { 
                transform: translateY(-15px) rotate(5deg) scale(1.1); 
                opacity: 0.8;
            }
            50% { 
                transform: translateY(-30px) rotate(10deg) scale(1); 
                opacity: 0.9;
            }
            75% { 
                transform: translateY(-15px) rotate(-5deg) scale(1.1); 
                opacity: 0.8;
            }
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 120px;
            right: 20px;
            background: linear-gradient(135deg, #7dd3fc, #0891b2);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 1001;
            cursor: pointer;
            transform: translateX(400px);
            transition: all 0.5s ease;
            max-width: 300px;
            backdrop-filter: blur(10px);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification:hover {
            transform: translateX(0) scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification-content {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        @media (max-width: 768px) {
            .nav-buttons {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .intro-title {
                font-size: 2rem;
            }
            
            .book {
                width: 300px;
                height: 450px;
            }
            
            .main-content {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Floating elements -->
    <div class="floating-elements">
        <div class="floating-leaf leaf1" style="left: 5%; top: 10%; animation-delay: 0s;"></div>
        <div class="floating-leaf leaf2" style="left: 85%; top: 15%; animation-delay: 1s;"></div>
        <div class="floating-leaf leaf3" style="left: 15%; top: 60%; animation-delay: 2s;"></div>
        <div class="floating-leaf leaf1" style="left: 75%; top: 70%; animation-delay: 3s;"></div>
        <div class="floating-leaf leaf2" style="left: 25%; top: 25%; animation-delay: 4s;"></div>
        <div class="floating-leaf leaf3" style="left: 65%; top: 40%; animation-delay: 5s;"></div>
        <div class="floating-leaf leaf1" style="left: 45%; top: 80%; animation-delay: 6s;"></div>
        <div class="floating-leaf leaf2" style="left: 90%; top: 50%; animation-delay: 7s;"></div>
        <div class="floating-leaf leaf3" style="left: 10%; top: 35%; animation-delay: 8s;"></div>
    </div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                <div class="logo-badge"></div>
                <span>Libby's Poetry Garden</span>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="showPage('intro')">
                    Home
                    <div class="nav-btn-leaf"></div>
                </button>
                <button class="nav-btn" onclick="showPage('book')">
                    Libby's Poetry
                    <div class="nav-btn-leaf"></div>
                </button>
                <button class="nav-btn" onclick="showPage('user-book')">
                    Community Poetry
                    <div class="nav-btn-leaf"></div>
                </button>
                <button class="nav-btn" onclick="showPage('submit')">
                    Submit Poetry
                    <div class="nav-btn-leaf"></div>
                </button>
                <button class="nav-btn" onclick="showPage('shop')">
                    Shop
                    <div class="nav-btn-leaf"></div>
                </button>
                <button class="nav-btn" onclick="showPage('admin-login')">
                    Admin
                    <div class="nav-btn-leaf"></div>
                </button>
            </div>
        </div>
    </nav>

    <!-- Announcement Bar -->
    <div class="announcement" id="announcement">
        Welcome to Libby's Poetry Garden - Where Nature Meets Words 🌸
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="notification-title">
            <span>🌸</span>
            <span id="notification-title-text">New Poetry Added!</span>
        </div>
        <div class="notification-content" id="notification-content">
            Click to view the new poem in the Community Collection
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Introduction Page -->
        <div id="intro" class="page active">
            <div class="intro-page">
                <h1 class="intro-title">Libby Nessworthy</h1>
                <h2 class="intro-subtitle">Poet of Nature & Love</h2>
                <div class="intro-text" id="intro-text">
                    Welcome to my poetic sanctuary where the whispers of nature dance with the melodies of love. I am Libby Nessworthy, a passionate poet who finds inspiration in the rustling leaves, blooming flowers, and the eternal dance between earth and heart.

                    My journey began in the quiet moments of dawn, when dewdrops held the secrets of the universe, and in the gentle embrace of twilight, where love stories are written in starlight. Each poem is a bridge between the natural world and the depths of human emotion.

                    Here, you'll discover verses that celebrate the changing seasons of both nature and the heart, exploring how love grows like wildflowers and how our souls mirror the rhythms of the earth. Join me in this garden of words where every stanza blooms with authenticity and wonder.
                </div>
            </div>
        </div>

        <!-- Poetry Book Page -->
        <div id="book" class="page">
            <div class="book-container">
                <div class="book" id="poetry-book" onclick="toggleBook('poetry-book')">
                    <div class="book-cover">
                        <div class="book-cover-content">
                            <h2>Libby Nessworthy</h2>
                            <h3>Poetry Archive</h3>
                            <p style="margin-top: 2rem; font-size: 1rem;">Click to open</p>
                        </div>
                    </div>
                    <div class="book-pages" id="book-content">
                        <!-- Poetry entries will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- User Poetry Book Page -->
        <div id="user-book" class="page">
            <div class="book-container">
                <div class="book" id="user-poetry-book" onclick="toggleBook('user-poetry-book')">
                    <div class="book-cover">
                        <div class="book-cover-content">
                            <h2>Community</h2>
                            <h3>Poetry Collection</h3>
                            <p style="margin-top: 2rem; font-size: 1rem;">Click to open</p>
                        </div>
                    </div>
                    <div class="book-pages" id="user-book-content">
                        <!-- User poetry entries will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- User Poetry Section -->
            <div class="user-poetry-section">
                <h3>Community Poetry Entries</h3>
                <div class="user-poetry-grid" id="user-poetry-grid">
                    <!-- User poetry cards will be populated here -->
                </div>
            </div>
        </div>

        <!-- Poetry Submission Page -->
        <div id="submit" class="page">
            <div class="form-container">
                <h2 style="text-align: center; margin-bottom: 2rem; color: #2d5016;">Share Your Poetry</h2>
                <div id="cooldown-notice" class="cooldown-message" style="display: none;">
                    Please wait before submitting another poem. Cooldown time remaining: <span id="cooldown-timer"></span>
                </div>
                <form id="poetry-form">
                    <div class="form-group">
                        <label for="poet-name">Your Name:</label>
                        <input type="text" id="poet-name" required>
                    </div>
                    <div class="form-group">
                        <label for="poem-title">Poem Title:</label>
                        <input type="text" id="poem-title" required>
                    </div>
                    <div class="form-group">
                        <label for="poem-content">Your Poem:</label>
                        <textarea id="poem-content" required placeholder="Share your beautiful words here..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="poem-image">Add an Image (optional):</label>
                        <input type="file" id="poem-image" accept="image/*">
                        <div id="poem-image-preview" class="image-preview"></div>
                    </div>
                    <button type="submit" class="submit-btn">
                        Plant Your Poetry 🌱
                        <div class="submit-btn-leaf"></div>
                    </button>
                </form>
            </div>
        </div>

        <!-- Shop Page -->
        <div id="shop" class="page">
            <h2 style="text-align: center; margin-bottom: 2rem; color: #2d5016;">Poetry Shop</h2>
            <div class="shop-grid" id="shop-items">
                <!-- Shop items will be populated here -->
            </div>
        </div>

        <!-- Admin Login Page -->
        <div id="admin-login" class="page">
            <div class="form-container">
                <h2 style="text-align: center; margin-bottom: 2rem; color: #2d5016;">Admin Login</h2>
                <div class="security-notice">
                    🔒 This admin panel uses enhanced security measures to protect against unauthorized access.
                </div>
                <form id="admin-login-form">
                    <div class="form-group">
                        <label for="admin-username">Username:</label>
                        <input type="text" id="admin-username" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-password">Password:</label>
                        <input type="password" id="admin-password" required>
                    </div>
                    <button type="submit" class="submit-btn">
                        Login
                        <div class="submit-btn-leaf"></div>
                    </button>
                </form>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" class="page">
            <div class="admin-panel">
                <!-- Admin Header -->
                <div class="admin-header">
                    <h2>⚙️ Poetry Garden Admin Panel</h2>
                    <p>Professional content management system</p>
                </div>
                
                <!-- Admin Tabs -->
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchAdminTab('overview', this)">
                        <span class="tab-icon">📊</span>Overview
                    </button>
                    <button class="admin-tab" onclick="switchAdminTab('libby-poetry', this)">
                        <span class="tab-icon">📖</span>Libby's Poetry
                    </button>
                    <button class="admin-tab" onclick="switchAdminTab('community-poetry', this)">
                        <span class="tab-icon">🌸</span>Community Poetry
                    </button>
                    <button class="admin-tab" onclick="switchAdminTab('shop-items', this)">
                        <span class="tab-icon">🛍️</span>Shop Items
                    </button>
                    <button class="admin-tab" onclick="switchAdminTab('user-management', this)" id="user-management-tab" style="display: none;">
                        <span class="tab-icon">👥</span>User Management
                    </button>
                    <button class="admin-tab" onclick="switchAdminTab('settings', this)">
                        <span class="tab-icon">⚙️</span>Settings
                    </button>
                </div>

                <!-- Overview Tab -->
                <div id="admin-tab-overview" class="admin-tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-number" id="stat-libby-poems">0</span>
                            <span class="stat-label">Libby's Poems</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="stat-community-poems">0</span>
                            <span class="stat-label">Community Poems</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="stat-shop-items">0</span>
                            <span class="stat-label">Shop Items</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number" id="stat-total-content">0</span>
                            <span class="stat-label">Total Content</span>
                        </div>
                    </div>
                    
                    <div class="admin-form-section">
                        <h4>🚀 Quick Actions</h4>
                        <div class="admin-buttons">
                            <button class="admin-btn" style="background: #007bff; color: white;" onclick="switchAdminTab('libby-poetry')">
                                Add New Poem
                            </button>
                            <button class="admin-btn" style="background: #28a745; color: white;" onclick="switchAdminTab('shop-items')">
                                Add Shop Item
                            </button>
                            <button class="admin-btn" style="background: #ffc107; color: #212529;" onclick="switchAdminTab('settings')">
                                Update Settings
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Libby's Poetry Tab -->
                <div id="admin-tab-libby-poetry" class="admin-tab-content">
                    <div class="admin-form-section">
                        <h4>✍️ Add New Poetry Entry</h4>
                        <form id="admin-poetry-form">
                            <div class="form-group">
                                <label for="admin-poem-title">Poem Title:</label>
                                <input type="text" id="admin-poem-title" required>
                            </div>
                            <div class="form-group">
                                <label for="admin-poem-content">Poem Content:</label>
                                <textarea id="admin-poem-content" required style="height: 120px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="admin-poem-author">Author:</label>
                                <input type="text" id="admin-poem-author" value="Libby Nessworthy" required>
                            </div>
                            <div class="form-group">
                                <label for="admin-poem-image">Upload Image (optional):</label>
                                <input type="file" id="admin-poem-image" accept="image/*">
                                <div id="admin-poem-image-preview" class="image-preview"></div>
                            </div>
                            <button type="submit" class="submit-btn">
                                Add Poetry Entry
                                <div class="submit-btn-leaf"></div>
                            </button>
                        </form>
                    </div>
                    
                    <h4>📚 Existing Poetry Entries</h4>
                    <div id="admin-libby-poetry-list" class="admin-items-grid">
                        <!-- Libby's poetry entries -->
                    </div>
                </div>

                <!-- Community Poetry Tab -->
                <div id="admin-tab-community-poetry" class="admin-tab-content">
                    <h4>🌸 Community Poetry Submissions</h4>
                    <p style="color: #6c757d; margin-bottom: 1.5rem;">Manage poetry submissions from the community</p>
                    <div id="admin-community-poetry-list" class="admin-items-grid">
                        <!-- Community poetry entries -->
                    </div>
                </div>

                <!-- Shop Items Tab -->
                <div id="admin-tab-shop-items" class="admin-tab-content">
                    <div class="admin-form-section">
                        <h4>🛍️ Add New Shop Item</h4>
                        <form id="shop-item-form">
                            <div class="form-group">
                                <label for="item-name">Item Name:</label>
                                <input type="text" id="item-name">
                            </div>
                            <div class="form-group">
                                <label for="item-description">Description:</label>
                                <textarea id="item-description"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="item-price">Price:</label>
                                <input type="text" id="item-price" placeholder="$24.99">
                            </div>
                            <div class="form-group">
                                <label for="item-image-file">Upload Image:</label>
                                <input type="file" id="item-image-file" accept="image/*">
                                <div id="item-image-preview" class="image-preview"></div>
                                <label for="item-image">Or Image URL:</label>
                                <input type="url" id="item-image">
                            </div>
                            <div class="form-group">
                                <label for="item-link">Link (optional):</label>
                                <input type="url" id="item-link">
                            </div>
                            <button type="submit" class="submit-btn">
                                Add Shop Item
                                <div class="submit-btn-leaf"></div>
                            </button>
                        </form>
                    </div>
                    
                    <h4>🛒 Current Shop Items</h4>
                    <div id="admin-shop-list" class="admin-items-grid">
                        <!-- Shop items -->
                    </div>
                </div>

                <!-- User Management Tab (Super Admin Only) -->
                <div id="admin-tab-user-management" class="admin-tab-content">
                    <div class="security-notice" style="background: rgba(220, 53, 69, 0.1); border: 2px solid #dc3545; margin-bottom: 2rem;">
                        🛡️ <strong>Security Notice:</strong> This section allows viewing and changing passwords in plain text. 
                        Only use this feature in a secure environment and ensure no unauthorized persons can view your screen.
                    </div>
                    
                    <div class="admin-form-section">
                        <h4>👥 Create New Admin Account</h4>
                        <p style="color: #6c757d; margin-bottom: 1.5rem;">Only the primary admin (Nessworthy) can create and manage other admin accounts. Choose permissions carefully based on the user's role and responsibilities.</p>
                        
                        <form id="create-admin-form">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                <div class="form-group">
                                    <label for="new-admin-username">Username:</label>
                                    <input type="text" id="new-admin-username" required placeholder="Enter unique username">
                                    <small style="color: #6c757d; font-size: 0.8rem;">Must be unique and at least 3 characters</small>
                                </div>
                                <div class="form-group">
                                    <label for="new-admin-password">Password:</label>
                                    <input type="password" id="new-admin-password" required placeholder="Minimum 6 characters">
                                    <small style="color: #6c757d; font-size: 0.8rem;">Strong password recommended</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Permission Level:</label>
                                <div style="margin: 1rem 0;">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                        <!-- Quick Permission Templates -->
                                        <div style="background: #333; padding: 1rem; border-radius: 8px; border: 2px solid transparent;" id="template-viewer">
                                            <h5 style="color: #7dd3fc; margin: 0 0 0.5rem 0; display: flex; align-items: center;">
                                                <span style="margin-right: 0.5rem;">👁️</span>Content Viewer
                                            </h5>
                                            <p style="color: #b0b0b0; font-size: 0.85rem; margin: 0 0 0.5rem 0;">Read-only access to view content</p>
                                            <button type="button" class="admin-btn" style="background: #17a2b8; font-size: 0.8rem;" onclick="setPermissionTemplate('viewer')">Apply Template</button>
                                        </div>
                                        
                                        <div style="background: #333; padding: 1rem; border-radius: 8px; border: 2px solid transparent;" id="template-editor">
                                            <h5 style="color: #28a745; margin: 0 0 0.5rem 0; display: flex; align-items: center;">
                                                <span style="margin-right: 0.5rem;">✏️</span>Content Editor
                                            </h5>
                                            <p style="color: #b0b0b0; font-size: 0.85rem; margin: 0 0 0.5rem 0;">Can view and edit content</p>
                                            <button type="button" class="admin-btn" style="background: #28a745; font-size: 0.8rem;" onclick="setPermissionTemplate('editor')">Apply Template</button>
                                        </div>
                                        
                                        <div style="background: #333; padding: 1rem; border-radius: 8px; border: 2px solid transparent;" id="template-moderator">
                                            <h5 style="color: #ffc107; margin: 0 0 0.5rem 0; display: flex; align-items: center;">
                                                <span style="margin-right: 0.5rem;">🛡️</span>Content Moderator
                                            </h5>
                                            <p style="color: #b0b0b0; font-size: 0.85rem; margin: 0 0 0.5rem 0;">Full content management access</p>
                                            <button type="button" class="admin-btn" style="background: #ffc107; color: #212529; font-size: 0.8rem;" onclick="setPermissionTemplate('moderator')">Apply Template</button>
                                        </div>
                                        
                                        <div style="background: #333; padding: 1rem; border-radius: 8px; border: 2px solid transparent;" id="template-manager">
                                            <h5 style="color: #dc3545; margin: 0 0 0.5rem 0; display: flex; align-items: center;">
                                                <span style="margin-right: 0.5rem;">⚙️</span>Site Manager
                                            </h5>
                                            <p style="color: #b0b0b0; font-size: 0.85rem; margin: 0 0 0.5rem 0;">All permissions except user management</p>
                                            <button type="button" class="admin-btn" style="background: #dc3545; font-size: 0.8rem;" onclick="setPermissionTemplate('manager')">Apply Template</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Custom Permissions:</label>
                                <div style="background: #2a2a2a; padding: 1.5rem; border-radius: 8px; border: 1px solid #404040; margin-top: 0.5rem;">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                        <div>
                                            <label style="display: flex; align-items: flex-start; margin-bottom: 1rem; font-weight: normal; cursor: pointer;">
                                                <input type="checkbox" id="perm-read" checked style="margin-right: 0.75rem; margin-top: 0.25rem;">
                                                <div>
                                                    <strong style="color: #7dd3fc;">👁️ Read Access</strong>
                                                    <div style="color: #b0b0b0; font-size: 0.85rem; margin-top: 0.25rem;">View all content in admin panels, browse poetry entries, shop items, and user submissions</div>
                                                </div>
                                            </label>
                                            
                                            <label style="display: flex; align-items: flex-start; margin-bottom: 1rem; font-weight: normal; cursor: pointer;">
                                                <input type="checkbox" id="perm-write" checked style="margin-right: 0.75rem; margin-top: 0.25rem;">
                                                <div>
                                                    <strong style="color: #28a745;">✏️ Write Access</strong>
                                                    <div style="color: #b0b0b0; font-size: 0.85rem; margin-top: 0.25rem;">Add and edit poetry entries, shop items, modify existing content</div>
                                                </div>
                                            </label>
                                        </div>
                                        
                                        <div>
                                            <label style="display: flex; align-items: flex-start; margin-bottom: 1rem; font-weight: normal; cursor: pointer;">
                                                <input type="checkbox" id="perm-delete" style="margin-right: 0.75rem; margin-top: 0.25rem;">
                                                <div>
                                                    <strong style="color: #ffc107;">🗑️ Delete Access</strong>
                                                    <div style="color: #b0b0b0; font-size: 0.85rem; margin-top: 0.25rem;">Remove poetry entries, shop items, and user submissions</div>
                                                </div>
                                            </label>
                                            
                                            <label style="display: flex; align-items: flex-start; margin-bottom: 1rem; font-weight: normal; cursor: pointer;">
                                                <input type="checkbox" id="perm-settings" style="margin-right: 0.75rem; margin-top: 0.25rem;">
                                                <div>
                                                    <strong style="color: #dc3545;">⚙️ Settings Access</strong>
                                                    <div style="color: #b0b0b0; font-size: 0.85rem; margin-top: 0.25rem;">Modify site announcements, introduction text, and other site settings</div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div id="permission-summary" style="margin-top: 1rem; padding: 1rem; background: #1a1a1a; border-radius: 4px; border-left: 4px solid #7dd3fc;">
                                        <strong style="color: #7dd3fc;">Current Selection:</strong>
                                        <span id="permission-summary-text" style="color: #b0b0b0; margin-left: 0.5rem;">Content Editor - Can view and edit content</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="submit-btn" style="width: 100%; margin-top: 1rem;">
                                👥 Create Admin Account
                                <div class="submit-btn-leaf"></div>
                            </button>
                        </form>
                    </div>
                    
                    <div class="admin-form-section">
                        <h4>🏛️ Current Admin Accounts</h4>
                        <div style="background: #333; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex-grow: 1;">
                                    <h5 style="color: #ffd700; margin: 0;">Nessworthy (Primary Admin)</h5>
                                    <p style="color: #b0b0b0; margin: 0; font-size: 0.9rem;">Super Admin - Full Access</p>
                                    <div style="margin-top: 0.5rem;">
                                        <strong>Password:</strong> 
                                        <span id="primary-password-display" style="font-family: monospace; background: #444; padding: 0.2rem 0.5rem; border-radius: 4px;">••••••••</span>
                                        <button type="button" class="admin-btn" style="background: #6c757d; margin-left: 0.5rem; font-size: 0.7rem; padding: 0.2rem 0.5rem;" onclick="togglePrimaryPasswordVisibility()">
                                            👁️ Show
                                        </button>
                                        <button type="button" class="admin-btn" style="background: #17a2b8; margin-left: 0.5rem; font-size: 0.7rem; padding: 0.2rem 0.5rem;" onclick="changePrimaryPassword()">
                                            🔑 Change
                                        </button>
                                    </div>
                                </div>
                                <div style="background: #1976d2; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">
                                    PRIMARY ADMIN
                                </div>
                            </div>
                            
                            <div class="edit-form" id="change-primary-password" style="margin-top: 1rem;">
                                <h4>🔑 Change Primary Admin Password</h4>
                                <div class="security-notice" style="margin-bottom: 1rem;">
                                    ⚠️ Changing your password will require you to log in again with the new password.
                                </div>
                                <div class="form-group">
                                    <label for="primary-current-password">Current Password:</label>
                                    <input type="password" id="primary-current-password" required style="background: #333; border: 1px solid #555; color: #fff; padding: 0.8rem; width: 100%; border-radius: 4px;">
                                </div>
                                <div class="form-group">
                                    <label for="primary-new-password">New Password:</label>
                                    <input type="password" id="primary-new-password" required style="background: #333; border: 1px solid #555; color: #fff; padding: 0.8rem; width: 100%; border-radius: 4px;">
                                </div>
                                <div class="form-group">
                                    <label for="primary-confirm-password">Confirm New Password:</label>
                                    <input type="password" id="primary-confirm-password" required style="background: #333; border: 1px solid #555; color: #fff; padding: 0.8rem; width: 100%; border-radius: 4px;">
                                </div>
                                <div class="admin-buttons">
                                    <button class="admin-btn save" onclick="savePrimaryPassword()">💾 Change Password</button>
                                    <button class="admin-btn cancel" onclick="cancelPrimaryPasswordChange()">❌ Cancel</button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="admin-accounts-list">
                            <!-- Secondary admin accounts will be populated here -->
                        </div>
                        
                        <div id="no-secondary-admins" style="text-align: center; color: #6c757d; padding: 2rem; border: 1px dashed #404040; border-radius: 8px;">
                            No secondary admin accounts created yet.<br>
                            Use the form above to create additional admin accounts.
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="admin-tab-settings" class="admin-tab-content">
                    <div class="admin-form-section">
                        <h4>📢 Manage Announcement</h4>
                        <div class="form-group">
                            <label for="announcement-text">Announcement Text:</label>
                            <input type="text" id="announcement-text">
                        </div>
                        <button class="submit-btn" onclick="updateAnnouncement()">
                            Update Announcement
                            <div class="submit-btn-leaf"></div>
                        </button>
                    </div>

                    <div class="admin-form-section">
                        <h4>📝 Manage Introduction Text</h4>
                        <div class="form-group">
                            <label for="intro-text-admin">Introduction Text:</label>
                            <textarea id="intro-text-admin" style="height: 200px;"></textarea>
                        </div>
                        <button class="submit-btn" onclick="updateIntroText()">
                            Update Introduction
                            <div class="submit-btn-leaf"></div>
                        </button>
                    </div>
                </div>

                <!-- Logout Section -->
                <div class="logout-section">
                    <button class="submit-btn" onclick="logout()" style="background: #dc3545;">
                        🚪 Logout from Admin Panel
                        <div class="submit-btn-leaf"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script>
        // ==================== ENHANCED SECURITY SYSTEM ====================
        
        /**
         * Enhanced Security Manager
         * Provides credential validation with hashing and obfuscation
         * Supports hierarchical admin system with primary and secondary admins
         */
        class SecurityManager {
            constructor() {
                // Primary admin (Super Admin) - Nessworthy
                this.primaryAdmin = {
                    username: this.simpleHash('Nessworthy'),
                    password: this.simpleHash('Nature'),
                    role: 'super_admin',
                    permissions: ['all']
                };
                
                // Load any updated primary admin password
                this.loadPrimaryAdminData();
                
                // Secondary admins storage
                this.loadAdminAccounts();
                
                // Additional security measures
                this.maxAttempts = 5;
                this.lockoutTime = 15 * 60 * 1000; // 15 minutes
                this.attempts = parseInt(localStorage.getItem('sec_attempts') || '0');
                this.lastLockout = parseInt(localStorage.getItem('sec_lockout') || '0');
                
                // Current logged in user info
                this.currentUser = null;
            }
            
            /**
             * Load primary admin data (for password changes)
             */
            loadPrimaryAdminData() {
                try {
                    const primaryAdminData = localStorage.getItem('libby_primary_admin_data');
                    if (primaryAdminData) {
                        const data = JSON.parse(primaryAdminData);
                        // Update the primary admin password hash if it was changed
                        if (data.passwordHash) {
                            this.primaryAdmin.password = data.passwordHash;
                        }
                    }
                } catch (error) {
                    console.error('Error loading primary admin data:', error);
                }
            }
            
            /**
             * Load admin accounts from localStorage
             */
            loadAdminAccounts() {
                try {
                    const savedAdmins = localStorage.getItem('libby_admin_accounts');
                    this.adminAccounts = savedAdmins ? JSON.parse(savedAdmins) : [];
                } catch (error) {
                    console.error('Error loading admin accounts:', error);
                    this.adminAccounts = [];
                }
            }
            
            /**
             * Save admin accounts to localStorage
             */
            saveAdminAccounts() {
                try {
                    localStorage.setItem('libby_admin_accounts', JSON.stringify(this.adminAccounts));
                } catch (error) {
                    console.error('Error saving admin accounts:', error);
                }
            }
            
            /**
             * Create a new admin account
             */
            createAdminAccount(username, password, permissions = ['read', 'write']) {
                if (!this.currentUser || this.currentUser.role !== 'super_admin') {
                    return { success: false, message: 'Only the primary admin can create new accounts.' };
                }
                
                // Check if username already exists
                const existsInPrimary = this.simpleHash(username) === this.primaryAdmin.username;
                const existsInSecondary = this.adminAccounts.find(admin => admin.username === this.simpleHash(username));
                
                if (existsInPrimary || existsInSecondary) {
                    return { success: false, message: 'Username already exists.' };
                }
                
                const newAdmin = {
                    id: Date.now(),
                    username: this.simpleHash(username),
                    password: this.simpleHash(password),
                    originalUsername: username, // Store for display purposes
                    originalPassword: this.encryptPassword(password), // Store encrypted but recoverable password
                    role: 'admin',
                    permissions: permissions,
                    createdBy: this.currentUser.username,
                    createdAt: new Date().toISOString()
                };
                
                this.adminAccounts.push(newAdmin);
                this.saveAdminAccounts();
                
                return { success: true, message: 'Admin account created successfully.', admin: newAdmin };
            }
            
            /**
             * Change admin account password
             */
            changeAdminPassword(adminId, newPassword) {
                if (!this.currentUser || this.currentUser.role !== 'super_admin') {
                    return { success: false, message: 'Only the primary admin can change passwords.' };
                }
                
                const adminIndex = this.adminAccounts.findIndex(admin => admin.id === adminId);
                if (adminIndex === -1) {
                    return { success: false, message: 'Admin account not found.' };
                }
                
                this.adminAccounts[adminIndex].password = this.simpleHash(newPassword);
                this.adminAccounts[adminIndex].originalPassword = this.encryptPassword(newPassword);
                this.adminAccounts[adminIndex].lastModified = new Date().toISOString();
                this.saveAdminAccounts();
                
                return { success: true, message: 'Password changed successfully.' };
            }
            
            /**
             * Get admin password (for super admin only)
             */
            getAdminPassword(adminId) {
                if (!this.currentUser || this.currentUser.role !== 'super_admin') {
                    return { success: false, message: 'Only the primary admin can view passwords.' };
                }
                
                const admin = this.adminAccounts.find(admin => admin.id === adminId);
                if (!admin) {
                    return { success: false, message: 'Admin account not found.' };
                }
                
                return { 
                    success: true, 
                    password: this.decryptPassword(admin.originalPassword),
                    username: admin.originalUsername
                };
            }
            
            /**
             * Simple encryption for password storage (reversible)
             * Note: This is for admin convenience, not high-security encryption
             */
            encryptPassword(password) {
                let encrypted = '';
                const key = 'pgarden2024'; // Simple key for encryption
                
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    const keyChar = key.charCodeAt(i % key.length);
                    encrypted += String.fromCharCode(char ^ keyChar);
                }
                
                return btoa(encrypted); // Base64 encode
            }
            
            /**
             * Simple decryption for password retrieval
             */
            decryptPassword(encryptedPassword) {
                try {
                    const encrypted = atob(encryptedPassword); // Base64 decode
                    let decrypted = '';
                    const key = 'pgarden2024';
                    
                    for (let i = 0; i < encrypted.length; i++) {
                        const char = encrypted.charCodeAt(i);
                        const keyChar = key.charCodeAt(i % key.length);
                        decrypted += String.fromCharCode(char ^ keyChar);
                    }
                    
                    return decrypted;
                } catch (error) {
                    return 'Error decrypting password';
                }
            }
            
            /**
             * Change primary admin password
             */
            changePrimaryPassword(currentPassword, newPassword) {
                if (!this.currentUser || this.currentUser.role !== 'super_admin') {
                    return { success: false, message: 'Unauthorized access.' };
                }
                
                // Verify current password
                const currentPasswordHash = this.simpleHash(currentPassword);
                if (currentPasswordHash !== this.primaryAdmin.password) {
                    return { success: false, message: 'Current password is incorrect.' };
                }
                
                // Update primary admin password (note: we don't store the primary password in recoverable form by default)
                this.primaryAdmin.password = this.simpleHash(newPassword);
                
                // Store in localStorage for persistence (encrypted)
                const primaryAdminData = {
                    passwordHash: this.primaryAdmin.password,
                    encryptedPassword: this.encryptPassword(newPassword),
                    lastChanged: new Date().toISOString()
                };
                localStorage.setItem('libby_primary_admin_data', JSON.stringify(primaryAdminData));
                
                return { success: true, message: 'Primary admin password changed successfully.' };
            }
            
            /**
             * Get primary admin password (for display purposes)
             */
            getPrimaryAdminPassword() {
                if (!this.currentUser || this.currentUser.role !== 'super_admin') {
                    return { success: false, message: 'Unauthorized access.' };
                }
                
                try {
                    const primaryAdminData = localStorage.getItem('libby_primary_admin_data');
                    if (primaryAdminData) {
                        const data = JSON.parse(primaryAdminData);
                        return { 
                            success: true, 
                            password: this.decryptPassword(data.encryptedPassword)
                        };
                    } else {
                        // Default password if no stored data
                        return { success: true, password: 'Nature' };
                    }
                } catch (error) {
                    return { success: true, password: 'Nature' }; // Fallback to default
                }
            }
            
            /**
             * Update admin account permissions
             */
            updateAdminAccount(adminId, newPermissions) {
                if (!this.currentUser || this.currentUser.role !== 'super_admin') {
                    return { success: false, message: 'Only the primary admin can modify accounts.' };
                }
                
                const adminIndex = this.adminAccounts.findIndex(admin => admin.id === adminId);
                if (adminIndex === -1) {
                    return { success: false, message: 'Admin account not found.' };
                }
                
                this.adminAccounts[adminIndex].permissions = newPermissions;
                this.adminAccounts[adminIndex].lastModified = new Date().toISOString();
                this.saveAdminAccounts();
                
                return { success: true, message: 'Admin account updated successfully.' };
            }
            
            /**
             * Delete admin account
             */
            deleteAdminAccount(adminId) {
                if (!this.currentUser || this.currentUser.role !== 'super_admin') {
                    return { success: false, message: 'Only the primary admin can delete accounts.' };
                }
                
                const adminIndex = this.adminAccounts.findIndex(admin => admin.id === adminId);
                if (adminIndex === -1) {
                    return { success: false, message: 'Admin account not found.' };
                }
                
                const deletedAdmin = this.adminAccounts.splice(adminIndex, 1)[0];
                this.saveAdminAccounts();
                
                return { success: true, message: 'Admin account deleted successfully.', deletedAdmin };
            }
            
            /**
             * Get all admin accounts (for display)
             */
            getAllAdminAccounts() {
                if (!this.currentUser || this.currentUser.role !== 'super_admin') {
                    return [];
                }
                
                return this.adminAccounts.map(admin => ({
                    id: admin.id,
                    username: admin.originalUsername,
                    role: admin.role,
                    permissions: admin.permissions,
                    createdAt: admin.createdAt,
                    lastModified: admin.lastModified
                }));
            }
            
            /**
             * Check if current user has specific permission
             */
            hasPermission(permission) {
                if (!this.currentUser) return false;
                if (this.currentUser.role === 'super_admin') return true;
                return this.currentUser.permissions.includes(permission) || this.currentUser.permissions.includes('all');
            }
            
            /**
             * Simple hash function for credential obfuscation
             * Not cryptographically secure but prevents casual viewing
             */
            simpleHash(str) {
                let hash = 0;
                if (str.length === 0) return hash;
                
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32-bit integer
                }
                
                // Additional obfuscation layers
                hash = Math.abs(hash);
                hash = hash.toString(16);
                hash = this.reverseString(hash);
                hash = this.addSalt(hash);
                
                return hash;
            }
            
            reverseString(str) {
                return str.split('').reverse().join('');
            }
            
            addSalt(str) {
                const salt = 'pg2024';
                return str + salt;
            }
            
            /**
             * Validates credentials against stored hashes (supports multiple admin accounts)
             */
            validateCredentials(username, password) {
                // Check if account is locked
                if (this.isAccountLocked()) {
                    return {
                        success: false,
                        message: 'Account temporarily locked due to multiple failed attempts. Please try again later.',
                        remainingTime: this.getRemainingLockoutTime()
                    };
                }
                
                const usernameHash = this.simpleHash(username.trim());
                const passwordHash = this.simpleHash(password.trim());
                
                // Check primary admin first
                if (usernameHash === this.primaryAdmin.username && passwordHash === this.primaryAdmin.password) {
                    this.resetAttempts();
                    this.currentUser = {
                        username: username.trim(),
                        role: 'super_admin',
                        permissions: ['all'],
                        loginTime: new Date().toISOString()
                    };
                    return { 
                        success: true, 
                        message: 'Primary Admin authentication successful',
                        user: this.currentUser
                    };
                }
                
                // Check secondary admins
                const secondaryAdmin = this.adminAccounts.find(admin => 
                    admin.username === usernameHash && admin.password === passwordHash
                );
                
                if (secondaryAdmin) {
                    this.resetAttempts();
                    this.currentUser = {
                        username: secondaryAdmin.originalUsername,
                        role: 'admin',
                        permissions: secondaryAdmin.permissions,
                        loginTime: new Date().toISOString()
                    };
                    return { 
                        success: true, 
                        message: 'Admin authentication successful',
                        user: this.currentUser
                    };
                }
                
                // Invalid credentials
                this.incrementAttempts();
                const remainingAttempts = this.maxAttempts - this.attempts;
                
                if (remainingAttempts <= 0) {
                    this.lockAccount();
                    return {
                        success: false,
                        message: 'Account locked due to too many failed attempts. Please try again in 15 minutes.'
                    };
                }
                
                return {
                    success: false,
                    message: `Invalid credentials. ${remainingAttempts} attempts remaining.`
                };
            }
            
            isAccountLocked() {
                if (this.lastLockout === 0) return false;
                const timeElapsed = Date.now() - this.lastLockout;
                return timeElapsed < this.lockoutTime;
            }
            
            getRemainingLockoutTime() {
                if (!this.isAccountLocked()) return 0;
                return Math.ceil((this.lockoutTime - (Date.now() - this.lastLockout)) / 1000 / 60);
            }
            
            incrementAttempts() {
                this.attempts++;
                localStorage.setItem('sec_attempts', this.attempts.toString());
            }
            
            resetAttempts() {
                this.attempts = 0;
                this.lastLockout = 0;
                localStorage.removeItem('sec_attempts');
                localStorage.removeItem('sec_lockout');
            }
            
            lockAccount() {
                this.lastLockout = Date.now();
                localStorage.setItem('sec_lockout', this.lastLockout.toString());
            }
            
            /**
             * Additional security check for session management
             */
            generateSessionToken() {
                const timestamp = Date.now();
                const random = Math.random().toString(36).substring(2);
                return this.simpleHash(timestamp + random);
            }
            
            /**
             * Validates session integrity
             */
            validateSession(token) {
                return token && token.length > 10; // Basic session validation
            }
        }

        // Initialize security manager
        const securityManager = new SecurityManager();
        let sessionToken = localStorage.getItem('admin_session_token');

        // Firebase configuration using compat version
        const firebaseConfig = {
            apiKey: "AIzaSyA5GJ9-rA-P2BXL4paZ9YKs_baFPQcpwIc",
            authDomain: "poeticlens-585ae.firebaseapp.com",
            projectId: "poeticlens-585ae",
            storageBucket: "poeticlens-585ae.firebasestorage.app",
            messagingSenderId: "214230848269",
            appId: "1:214230848269:web:61cdfdc7c1a7d89da29644"
        };

        let app, db;
        let firebaseEnabled = false;

        // Try to initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebaseEnabled = true;
            console.log('✅ Firebase connected successfully');
        } catch (error) {
            console.log('⚠️ Firebase not available, using localStorage:', error.message);
            firebaseEnabled = false;
        }

        // Data storage with dual persistence
        let poetryEntries = [
            {
                id: 1,
                title: "Wild Child",
                content: "The summer leaves whisper to me,\nCome out and play again, wild child,\nThe trees miss your untethered heart.\nThe summer birds sing to me,\nCome dance beneath us, wild child,\nUse our wings to lift your mind.\nThe summer beat of my footsteps on soil calls to me,\nLet go with each step, wild child,\nYour wildness makes you beautiful.\nThe summer sun on delicate, intricate petals feeds my soul,\nFeel it soak into your face, wild child,\nBe reborn, be home, be whole.\nShe still lingers within.",
                author: "Libby Nessworthy",
                isAdmin: true,
                image: "https://scontent-man2-1.xx.fbcdn.net/v/t39.30808-6/501631554_122156928800568294_5438287569295846653_n.jpg?stp=cp6_dst-jpg_s720x720_tt6&_nc_cat=105&ccb=1-7&_nc_sid=833d8c&_nc_ohc=RQB3upzL-WoQ7kNvwFawezN&_nc_oc=Adnu1kKFnOvThcD1sD_m3HAF2Rilwcz1kohYd-frGhrqDGSbyawRp2laxUm3txInL9Tki5ouQofWzmhwoFu3AZLp&_nc_zt=23&_nc_ht=scontent-man2-1.xx&_nc_gid=HmXyqXlHFRm8j_Lb6iS3XA&oh=00_AfI7WSzScSOglpImkWzNg6bCwWUiFVJ8aNN26TgpBhSrDA&oe=684264E6"
            },
            {
                id: 2,
                title: "Flowering",
                content: "Secret forest warmth,\nbeautiful, quiet breath,\nbeneath cycles of the moon,\nnature lighting my way,\npoetry pulsing through my fingertips,\nI am flowering here.",
                author: "Libby Nessworthy",
                isAdmin: true,
                image: "https://scontent-man2-1.xx.fbcdn.net/v/t39.30808-6/492123195_122150141522568294_1437317788203308205_n.jpg?stp=cp6_dst-jpg_s720x720_tt6&_nc_cat=104&ccb=1-7&_nc_sid=833d8c&_nc_ohc=g3c7k4gw534Q7kNvwHAXKgD&_nc_oc=Adn1hBjrbu_vAS5NOvxEd8-ePWeKShtkqle00mRo2Ep1zoWd-UeUQOK5KMCopD1B-htYTxQpC9lQAIL5-ymNJ1i_&_nc_zt=23&_nc_ht=scontent-man2-1.xx&_nc_gid=eIifBj0VfPFACNzIVQqSLQ&oh=00_AfJx8syap8I5ocvJ1N4b3a9tRyCqOWKvaghiWvAf6jtPKg&oe=684268E6"
            }
        ];

        let shopItems = [
            {
                id: 1,
                name: "Poetry Collection - 'Nature's Love'",
                description: "A beautiful hardcover collection of Libby's most beloved nature and love poems.",
                price: "$24.99",
                image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'%3E%3Crect fill='%238B4513' width='300' height='200'/%3E%3Ctext x='50%' y='50%' text-anchor='middle' fill='gold' font-size='16' font-family='serif'%3EPoetry Book%3C/text%3E%3C/svg%3E",
                link: ""
            }
        ];

        let userSubmissions = [];
        let cooldownUsers = {};
        let isLoggedIn = false;
        let currentAdminUser = null; // Store current admin user info
        let currentAnnouncement = "Welcome to Libby's Poetry Garden - Where Ocean Meets Words 🌊";
        let currentIntroText = "Welcome to my poetic sanctuary where the whispers of nature dance with the melodies of love. I am Libby Nessworthy, a passionate poet who finds inspiration in the flowing tides, endless skies, and the eternal dance between ocean and heart.\n\nMy journey began in the quiet moments of dawn, when morning mist held the secrets of the universe, and in the gentle embrace of twilight, where love stories are written in starlight. Each poem is a bridge between the natural world and the depths of human emotion.\n\nHere, you'll discover verses that celebrate the changing seasons of both nature and the heart, exploring how love flows like ocean currents and how our souls mirror the rhythms of the tides. Join me in this garden of words where every stanza blooms with authenticity and wonder.";
        let latestPoetryId = null;

        // ==================== STORAGE FUNCTIONS ====================

        // Save to localStorage (backup)
        function saveToLocalStorage() {
            try {
                localStorage.setItem('libby_poetryEntries', JSON.stringify(poetryEntries));
                localStorage.setItem('libby_userSubmissions', JSON.stringify(userSubmissions));
                localStorage.setItem('libby_shopItems', JSON.stringify(shopItems));
                localStorage.setItem('libby_announcement', currentAnnouncement);
                localStorage.setItem('libby_introText', currentIntroText);
                console.log('💾 Data saved to localStorage');
            } catch (error) {
                console.error('❌ Error saving to localStorage:', error);
            }
        }

        // Load from localStorage
        function loadFromLocalStorage() {
            try {
                const savedPoetry = localStorage.getItem('libby_poetryEntries');
                const savedSubmissions = localStorage.getItem('libby_userSubmissions');
                const savedShop = localStorage.getItem('libby_shopItems');
                const savedAnnouncement = localStorage.getItem('libby_announcement');
                const savedIntroText = localStorage.getItem('libby_introText');

                if (savedPoetry) poetryEntries = JSON.parse(savedPoetry);
                if (savedSubmissions) userSubmissions = JSON.parse(savedSubmissions);
                if (savedShop) shopItems = JSON.parse(savedShop);
                if (savedAnnouncement) currentAnnouncement = savedAnnouncement;
                if (savedIntroText) currentIntroText = savedIntroText;

                console.log('📁 Data loaded from localStorage');
            } catch (error) {
                console.error('❌ Error loading from localStorage:', error);
            }
        }

        // Save to Firebase (primary)
        async function saveToFirebase(collection_name, data) {
            if (!firebaseEnabled) return false;
            
            try {
                await db.collection(collection_name).add({
                    ...data,
                    timestamp: new Date(),
                    synced: true
                });
                console.log(`☁️ Data saved to Firebase: ${collection_name}`);
                return true;
            } catch (error) {
                console.error(`❌ Error saving to Firebase: ${collection_name}`, error);
                return false;
            }
        }

        // Load from Firebase
        async function loadFromFirebase() {
            if (!firebaseEnabled) return false;

            try {
                // Load user submissions
                const userSubmissionsSnapshot = await db.collection('userSubmissions').get();
                const firebaseUserSubmissions = [];
                userSubmissionsSnapshot.forEach((doc) => {
                    firebaseUserSubmissions.push({ firebaseId: doc.id, ...doc.data() });
                });

                // Load shop items
                const shopSnapshot = await db.collection('shopItems').get();
                const firebaseShopItems = [...shopItems]; // Keep default items
                shopSnapshot.forEach((doc) => {
                    firebaseShopItems.push({ firebaseId: doc.id, ...doc.data() });
                });

                // Load settings
                const settingsSnapshot = await db.collection('settings').get();
                settingsSnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.type === 'announcement') currentAnnouncement = data.value;
                    if (data.type === 'introText') currentIntroText = data.value;
                });

                // Update local data
                userSubmissions = firebaseUserSubmissions;
                shopItems = firebaseShopItems;

                console.log('☁️ Data loaded from Firebase');
                return true;
            } catch (error) {
                console.error('❌ Error loading from Firebase:', error);
                return false;
            }
        }

        // Set up real-time listeners for Firebase
        function setupFirebaseListeners() {
            if (!firebaseEnabled) return;

            // Listen for new user submissions
            db.collection('userSubmissions').onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added') {
                        const newSubmission = { firebaseId: change.doc.id, ...change.doc.data() };
                        const exists = userSubmissions.find(sub => sub.firebaseId === newSubmission.firebaseId);
                        if (!exists) {
                            userSubmissions.push(newSubmission);
                            saveToLocalStorage(); // Backup to localStorage
                            console.log('🔄 New submission received from Firebase');
                            
                            // Show notification for new submissions from others
                            if (newSubmission.id !== latestPoetryId) {
                                showNotification(
                                    'New Community Poetry! 🌸',
                                    `"${newSubmission.title}" by ${newSubmission.author}`,
                                    newSubmission.id
                                );
                            }
                        }
                    }
                });
            });
        }

        // Hybrid save function
        async function saveData(type, data) {
            // Always save to localStorage first (immediate backup)
            saveToLocalStorage();

            // Try to save to Firebase
            if (firebaseEnabled) {
                const success = await saveToFirebase(type, data);
                if (success) {
                    console.log('✅ Data saved to both localStorage and Firebase');
                } else {
                    console.log('⚠️ Saved to localStorage only (Firebase unavailable)');
                }
            } else {
                console.log('💾 Saved to localStorage only (Firebase not configured)');
            }
        }

        // ==================== NAVIGATION & UI FUNCTIONS ====================

        // Navigation function
        function showPage(pageId) {
            console.log('Showing page:', pageId);
            
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Handle specific page logic
            if (pageId === 'book') {
                populateBook();
            } else if (pageId === 'user-book') {
                populateUserBook();
            } else if (pageId === 'user-book') {
                populateUserBook();
            } else if (pageId === 'shop') {
                populateShop();
            } else if (pageId === 'admin-panel') {
                if (isLoggedIn && securityManager.validateSession(sessionToken)) {
                    // Show/hide user management tab based on user role
                    const userManagementTab = document.getElementById('user-management-tab');
                    if (currentAdminUser && currentAdminUser.role === 'super_admin') {
                        userManagementTab.style.display = 'block';
                    } else {
                        userManagementTab.style.display = 'none';
                    }
                    
                    // Initialize admin panel and set overview tab as active
                    populateAdminPanel();
                    // Small delay to ensure content is loaded before switching tab
                    setTimeout(() => switchAdminTab('overview'), 100);
                } else {
                    isLoggedIn = false;
                    sessionToken = null;
                    currentAdminUser = null;
                    localStorage.removeItem('admin_session_token');
                    showPage('admin-login');
                    return;
                }
            } else if (pageId === 'submit') {
                checkCooldown();
            }
        }

        // Book functionality
        function toggleBook(bookId) {
            const book = document.getElementById(bookId);
            book.classList.toggle('open');
        }

        function populateBook() {
            const bookContent = document.getElementById('book-content');
            
            bookContent.innerHTML = poetryEntries.map(entry => `
                <div class="poetry-entry">
                    <div class="poetry-title">${entry.title}</div>
                    ${entry.image ? `<img src="${entry.image}" alt="${entry.title}" class="poetry-image">` : ''}
                    <div class="poetry-content">${entry.content}</div>
                    <div class="poetry-author">~ ${entry.author}</div>
                </div>
            `).join('');
        }

        function populateUserBook() {
            const userBookContent = document.getElementById('user-book-content');
            const userPoetryGrid = document.getElementById('user-poetry-grid');
            
            if (userSubmissions.length === 0) {
                userBookContent.innerHTML = `
                    <div class="poetry-entry">
                        <div class="poetry-title">Welcome to Community Poetry</div>
                        <div class="poetry-content">This beautiful collection will grow as poets like you share their voices. Be the first to add your poem to this community anthology!</div>
                        <div class="poetry-author">~ The Poetry Garden</div>
                    </div>
                `;
                userPoetryGrid.innerHTML = `
                    <div class="user-poetry-card">
                        <h4>No poems yet</h4>
                        <div class="author">~ Community</div>
                        <div class="preview">Be the first to share your poetry with our community! Click "Submit Poetry" to add your voice to this collection.</div>
                    </div>
                `;
            } else {
                userBookContent.innerHTML = userSubmissions.map(entry => `
                    <div class="poetry-entry" id="poem-${entry.id}">
                        <div class="poetry-title">${entry.title}</div>
                        ${entry.image ? `<img src="${entry.image}" alt="${entry.title}" class="poetry-image">` : ''}
                        <div class="poetry-content">${entry.content}</div>
                        <div class="poetry-author">~ ${entry.author}</div>
                    </div>
                `).join('');

                userPoetryGrid.innerHTML = userSubmissions.map(entry => `
                    <div class="user-poetry-card" onclick="viewPoetryInBook(${entry.id})">
                        <h4>${entry.title}</h4>
                        <div class="author">~ ${entry.author}</div>
                        <div class="preview">${entry.content.split('\n')[0]}...</div>
                    </div>
                `).join('');
            }
        }

        function viewPoetryInBook(poetryId) {
            const book = document.getElementById('user-poetry-book');
            if (!book.classList.contains('open')) {
                book.classList.add('open');
            }
            
            setTimeout(() => {
                const poemElement = document.getElementById(`poem-${poetryId}`);
                if (poemElement) {
                    poemElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    poemElement.style.background = 'rgba(255, 138, 101, 0.3)';
                    poemElement.style.transition = 'background 0.5s ease';
                    setTimeout(() => {
                        poemElement.style.background = 'rgba(255, 248, 220, 0.3)';
                    }, 2000);
                }
            }, 800);
        }

        function showNotification(title, content, poetryId = null) {
            const notification = document.getElementById('notification');
            const titleElement = document.getElementById('notification-title-text');
            const contentElement = document.getElementById('notification-content');
            
            titleElement.textContent = title;
            contentElement.textContent = content;
            
            notification.classList.add('show');
            
            notification.onclick = () => {
                hideNotification();
                if (poetryId) {
                    showPage('user-book');
                    setTimeout(() => viewPoetryInBook(poetryId), 500);
                }
            };
            
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }

        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('show');
            notification.onclick = null;
        }

        // Image handling functions
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function handleImagePreview(event, previewId) {
            const file = event.target.files[0];
            const preview = document.getElementById(previewId);
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <button type="button" class="remove-image-btn" onclick="removeImagePreview('${previewId}', '${event.target.id}')">Remove</button>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '';
            }
        }

        function removeImagePreview(previewId, inputId) {
            document.getElementById(previewId).innerHTML = '';
            document.getElementById(inputId).value = '';
        }

        // Cooldown management
        function checkCooldown() {
            const poetName = document.getElementById('poet-name').value;
            const cooldownNotice = document.getElementById('cooldown-notice');
            const cooldownTimer = document.getElementById('cooldown-timer');
            
            if (poetName && cooldownUsers[poetName] && Date.now() < cooldownUsers[poetName]) {
                const remainingTime = Math.ceil((cooldownUsers[poetName] - Date.now()) / 1000 / 60);
                cooldownNotice.style.display = 'block';
                cooldownTimer.textContent = `${remainingTime} minutes`;
                
                const interval = setInterval(() => {
                    const remaining = Math.ceil((cooldownUsers[poetName] - Date.now()) / 1000 / 60);
                    if (remaining <= 0) {
                        cooldownNotice.style.display = 'none';
                        clearInterval(interval);
                    } else {
                        cooldownTimer.textContent = `${remaining} minutes`;
                    }
                }, 60000);
            } else {
                cooldownNotice.style.display = 'none';
            }
        }

        // Shop functionality
        function populateShop() {
            const shopContainer = document.getElementById('shop-items');
            shopContainer.innerHTML = shopItems.map(item => `
                <div class="shop-item">
                    <img src="${item.image}" alt="${item.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'300\\' height=\\'200\\' viewBox=\\'0 0 300 200\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'300\\' height=\\'200\\'/%3E%3Ctext x=\\'50%\\' y=\\'50%\\' text-anchor=\\'middle\\' fill=\\'%23666\\' font-size=\\'14\\'%3ENo Image%3C/text%3E%3C/svg%3E'">
                    <h3>${item.name}</h3>
                    <p>${item.description}</p>
                    <div class="price">${item.price}</div>
                    ${item.link ? `<a href="${item.link}" target="_blank" style="color: #90c695; text-decoration: none;">View Item →</a>` : ''}
                </div>
            `).join('');
        }

        // Admin tab switching
        function switchAdminTab(tabName, element = null) {
            // Hide all tab contents
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`admin-tab-${tabName}`).classList.add('active');
            
            // Add active class to clicked tab
            if (element) {
                element.classList.add('active');
            } else {
                // Fallback for programmatic calls
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    if (tab.getAttribute('onclick').includes(tabName)) {
                        tab.classList.add('active');
                    }
                });
            }
            
            // Populate content based on tab
            if (tabName === 'overview') {
                updateAdminStats();
            } else if (tabName === 'libby-poetry') {
                populateLibbyPoetryTab();
            } else if (tabName === 'community-poetry') {
                populateCommunityPoetryTab();
            } else if (tabName === 'shop-items') {
                populateShopItemsTab();
            } else if (tabName === 'user-management') {
                populateUserManagementTab();
            } else if (tabName === 'settings') {
                populateSettingsTab();
            }
        }

        // Update admin statistics
        function updateAdminStats() {
            document.getElementById('stat-libby-poems').textContent = poetryEntries.length;
            document.getElementById('stat-community-poems').textContent = userSubmissions.length;
            document.getElementById('stat-shop-items').textContent = shopItems.length;
            document.getElementById('stat-total-content').textContent = poetryEntries.length + userSubmissions.length + shopItems.length;
        }

        // Populate Libby's Poetry tab
        function populateLibbyPoetryTab() {
            const container = document.getElementById('admin-libby-poetry-list');
            
            if (poetryEntries.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 2rem;">No poetry entries yet. Add your first poem above!</p>';
                return;
            }
            
            container.innerHTML = poetryEntries.map(entry => `
                <div class="admin-item-card" id="poetry-${entry.id}">
                    <div class="poetry-display" id="display-${entry.id}">
                        <div class="admin-item-header">
                            <div>
                                <h5 class="admin-item-title">${entry.title}</h5>
                                <div class="admin-item-author">by ${entry.author}</div>
                            </div>
                            ${entry.image ? `<img src="${entry.image}" alt="${entry.title}" class="admin-item-image">` : ''}
                        </div>
                        <div class="admin-item-content">${entry.content.substring(0, 150)}${entry.content.length > 150 ? '...' : ''}</div>
                        <div class="admin-buttons">
                            <button class="admin-btn edit" onclick="editPoetry(${entry.id}, ${entry.isAdmin})">✏️ Edit</button>
                            <button class="admin-btn delete" onclick="deletePoetry(${entry.id}, ${entry.isAdmin})">🗑️ Delete</button>
                        </div>
                    </div>
                    
                    <div class="edit-form" id="edit-${entry.id}">
                        <h4>✏️ Edit Community Poetry</h4>
                        <div class="form-group">
                            <label>Title:</label>
                            <input type="text" id="edit-title-${entry.id}" value="${entry.title}">
                        </div>
                        <div class="form-group">
                            <label>Author:</label>
                            <input type="text" id="edit-author-${entry.id}" value="${entry.author}">
                        </div>
                        <div class="form-group">
                            <label>Content:</label>
                            <textarea id="edit-content-${entry.id}" style="height: 120px;">${entry.content}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Change Image (optional):</label>
                            <input type="file" id="edit-image-${entry.id}" accept="image/*">
                            <div id="edit-image-preview-${entry.id}" class="image-preview">
                                ${entry.image ? `<img src="${entry.image}" alt="Current image"><button type="button" class="remove-image-btn" onclick="removeCurrentImage(${entry.id})">Remove Current Image</button>` : ''}
                            </div>
                        </div>
                        <div class="admin-buttons">
                            <button class="admin-btn save" onclick="savePoetryEdit(${entry.id}, ${entry.isAdmin})">💾 Save Changes</button>
                            <button class="admin-btn cancel" onclick="cancelPoetryEdit(${entry.id})">❌ Cancel</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Populate Shop Items tab
        function populateShopItemsTab() {
            const container = document.getElementById('admin-shop-list');
            
            container.innerHTML = shopItems.map(item => `
                <div class="admin-item-card">
                    <div class="admin-item-header">
                        <div>
                            <h5 class="admin-item-title">${item.name}</h5>
                            <div class="admin-item-author">${item.price}</div>
                        </div>
                        <img src="${item.image}" alt="${item.name}" class="admin-item-image">
                    </div>
                    <div class="admin-item-content">${item.description}</div>
                    ${item.link ? `<p><a href="${item.link}" target="_blank" style="color: #90c695;">🔗 View Item</a></p>` : ''}
                    <div class="admin-buttons">
                        <button class="admin-btn delete" onclick="deleteShopItem(${item.id})">🗑️ Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Populate Settings tab
        function populateSettingsTab() {
            document.getElementById('announcement-text').value = currentAnnouncement;
            document.getElementById('intro-text-admin').value = currentIntroText;
        }

        // Updated populateAdminPanel function
        function populateAdminPanel() {
            updateAdminStats();
            populateLibbyPoetryTab();
            populateCommunityPoetryTab();
            populateShopItemsTab();
            populateSettingsTab();
            
            // Only populate user management for super admin
            if (currentAdminUser && currentAdminUser.role === 'super_admin') {
                populateUserManagementTab();
            }
        }

        function updateAnnouncement() {
            // Check settings permission
            if (!securityManager.hasPermission('settings')) {
                alert('❌ You do not have permission to modify site settings.');
                return;
            }
            
            currentAnnouncement = document.getElementById('announcement-text').value;
            document.getElementById('announcement').textContent = currentAnnouncement;
            
            // Save to both storage systems
            saveData('settings', { type: 'announcement', value: currentAnnouncement });
            alert('Announcement updated successfully!');
        }

        function updateIntroText() {
            // Check settings permission
            if (!securityManager.hasPermission('settings')) {
                alert('❌ You do not have permission to modify site settings.');
                return;
            }
            
            currentIntroText = document.getElementById('intro-text-admin').value;
            document.getElementById('intro-text').textContent = currentIntroText;
            
            // Save to both storage systems
            saveData('settings', { type: 'introText', value: currentIntroText });
            alert('Introduction text updated successfully!');
        }

        function editPoetry(id, isAdmin) {
            document.getElementById(`display-${id}`).style.display = 'none';
            document.getElementById(`edit-${id}`).classList.add('active');
        }

        function cancelPoetryEdit(id) {
            document.getElementById(`display-${id}`).style.display = 'block';
            document.getElementById(`edit-${id}`).classList.remove('active');
        }

        async function savePoetryEdit(id, isAdmin) {
            const title = document.getElementById(`edit-title-${id}`).value;
            const author = document.getElementById(`edit-author-${id}`).value;
            const content = document.getElementById(`edit-content-${id}`).value;
            
            let imageData = null;
            const imageFile = document.getElementById(`edit-image-${id}`).files[0];
            if (imageFile) {
                imageData = await convertImageToBase64(imageFile);
            }
            
            const entries = isAdmin ? poetryEntries : userSubmissions;
            const entryIndex = entries.findIndex(entry => entry.id === id);
            
            if (entryIndex !== -1) {
                entries[entryIndex].title = title;
                entries[entryIndex].author = author;
                entries[entryIndex].content = content;
                
                if (imageData) {
                    entries[entryIndex].image = imageData;
                }
                if (entries[entryIndex].removeImage) {
                    entries[entryIndex].image = null;
                    delete entries[entryIndex].removeImage;
                }
            }
            
            populateAdminPanel();
            alert('Poetry entry updated successfully!');
        }

        function deletePoetry(id, isAdmin) {
            // Check delete permission
            if (!securityManager.hasPermission('delete')) {
                alert('❌ You do not have permission to delete content.');
                return;
            }
            
            if (confirm('Are you sure you want to delete this poetry entry?')) {
                if (isAdmin) {
                    poetryEntries = poetryEntries.filter(entry => entry.id !== id);
                } else {
                    userSubmissions = userSubmissions.filter(entry => entry.id !== id);
                }
                populateAdminPanel();
                alert('Poetry entry deleted successfully!');
            }
        }

        function deleteShopItem(id) {
            // Check delete permission
            if (!securityManager.hasPermission('delete')) {
                alert('❌ You do not have permission to delete content.');
                return;
            }
            
            if (confirm('Are you sure you want to delete this shop item?')) {
                shopItems = shopItems.filter(item => item.id !== id);
                populateAdminPanel();
                alert('Shop item deleted successfully!');
            }
        }

        function removeCurrentImage(id) {
            const isAdmin = poetryEntries.find(entry => entry.id === id) ? true : false;
            const entries = isAdmin ? poetryEntries : userSubmissions;
            const entry = entries.find(entry => entry.id === id);
            if (entry) {
                entry.removeImage = true;
                document.getElementById(`edit-image-preview-${id}`).innerHTML = '<p style="color: #dc3545;">Image will be removed when changes are saved</p>';
            }
        }

        // Populate User Management tab
        function populateUserManagementTab() {
            if (!currentAdminUser || currentAdminUser.role !== 'super_admin') {
                return;
            }
            
            const adminsList = document.getElementById('admin-accounts-list');
            const noAdminsMessage = document.getElementById('no-secondary-admins');
            
            const secondaryAdmins = securityManager.getAllAdminAccounts();
            
            if (secondaryAdmins.length === 0) {
                adminsList.innerHTML = '';
                noAdminsMessage.style.display = 'block';
            } else {
                noAdminsMessage.style.display = 'none';
                adminsList.innerHTML = secondaryAdmins.map(admin => `
                    <div class="admin-item-card" style="margin-bottom: 1rem;">
                        <div class="admin-item-header">
                            <div>
                                <h5 class="admin-item-title">${admin.username}</h5>
                                <div class="admin-item-author">Role: ${admin.role} | Created: ${new Date(admin.createdAt).toLocaleDateString()}</div>
                                <div style="margin-top: 0.5rem;">
                                    <strong>Permissions:</strong> ${admin.permissions.join(', ')}
                                </div>
                                <div style="margin-top: 0.5rem;">
                                    <strong>Password:</strong> 
                                    <span id="password-display-${admin.id}" style="font-family: monospace; background: #444; padding: 0.2rem 0.5rem; border-radius: 4px;">••••••••</span>
                                    <button type="button" class="admin-btn" style="background: #6c757d; margin-left: 0.5rem; font-size: 0.7rem; padding: 0.2rem 0.5rem;" onclick="togglePasswordVisibility(${admin.id})">
                                        👁️ Show
                                    </button>
                                </div>
                            </div>
                            <div style="background: #ff9800; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">
                                SECONDARY ADMIN
                            </div>
                        </div>
                        <div class="admin-buttons" style="margin-top: 1rem;">
                            <button class="admin-btn edit" onclick="editAdminPermissions(${admin.id})">✏️ Edit Permissions</button>
                            <button class="admin-btn" style="background: #17a2b8; color: white;" onclick="changeAdminPassword(${admin.id})">🔑 Change Password</button>
                            <button class="admin-btn delete" onclick="deleteAdminAccount(${admin.id})">🗑️ Delete Account</button>
                        </div>
                        
                        <div class="edit-form" id="edit-admin-${admin.id}">
                            <h4>✏️ Edit Admin Permissions</h4>
                            <div class="form-group">
                                <label>Permissions for ${admin.username}:</label>
                                <div style="margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; margin-bottom: 0.5rem; font-weight: normal;">
                                        <input type="checkbox" id="edit-perm-read-${admin.id}" ${admin.permissions.includes('read') ? 'checked' : ''} style="margin-right: 0.5rem;">
                                        Read Access
                                    </label>
                                    <label style="display: flex; align-items: center; margin-bottom: 0.5rem; font-weight: normal;">
                                        <input type="checkbox" id="edit-perm-write-${admin.id}" ${admin.permissions.includes('write') ? 'checked' : ''} style="margin-right: 0.5rem;">
                                        Write Access
                                    </label>
                                    <label style="display: flex; align-items: center; margin-bottom: 0.5rem; font-weight: normal;">
                                        <input type="checkbox" id="edit-perm-delete-${admin.id}" ${admin.permissions.includes('delete') ? 'checked' : ''} style="margin-right: 0.5rem;">
                                        Delete Access
                                    </label>
                                    <label style="display: flex; align-items: center; margin-bottom: 0.5rem; font-weight: normal;">
                                        <input type="checkbox" id="edit-perm-settings-${admin.id}" ${admin.permissions.includes('settings') ? 'checked' : ''} style="margin-right: 0.5rem;">
                                        Settings Access
                                    </label>
                                </div>
                            </div>
                            <div class="admin-buttons">
                                <button class="admin-btn save" onclick="saveAdminPermissions(${admin.id})">💾 Save Changes</button>
                                <button class="admin-btn cancel" onclick="cancelAdminEdit(${admin.id})">❌ Cancel</button>
                            </div>
                        </div>
                        
                        <div class="edit-form" id="change-password-${admin.id}">
                            <h4>🔑 Change Password for ${admin.username}</h4>
                            <div class="security-notice" style="margin-bottom: 1rem;">
                                ⚠️ Changing the password will immediately affect the user's ability to log in.
                            </div>
                            <div class="form-group">
                                <label for="new-password-${admin.id}">New Password:</label>
                                <input type="password" id="new-password-${admin.id}" required style="background: #333; border: 1px solid #555; color: #fff; padding: 0.8rem; width: 100%; border-radius: 4px;">
                            </div>
                            <div class="form-group">
                                <label for="confirm-password-${admin.id}">Confirm New Password:</label>
                                <input type="password" id="confirm-password-${admin.id}" required style="background: #333; border: 1px solid #555; color: #fff; padding: 0.8rem; width: 100%; border-radius: 4px;">
                            </div>
                            <div class="admin-buttons">
                                <button class="admin-btn save" onclick="saveNewPassword(${admin.id})">💾 Change Password</button>
                                <button class="admin-btn cancel" onclick="cancelPasswordChange(${admin.id})">❌ Cancel</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Toggle password visibility
        function togglePasswordVisibility(adminId) {
            const passwordDisplay = document.getElementById(`password-display-${adminId}`);
            const button = passwordDisplay.nextElementSibling;
            
            if (passwordDisplay.textContent === '••••••••') {
                // Show password with security confirmation
                if (confirm('⚠️ SECURITY WARNING ⚠️\n\nYou are about to view a user password in plain text.\n\nThis action should only be performed in a secure environment.\n\nDo you want to continue?')) {
                    const result = securityManager.getAdminPassword(adminId);
                    if (result.success) {
                        passwordDisplay.textContent = result.password;
                        passwordDisplay.style.background = '#dc3545';
                        passwordDisplay.style.color = 'white';
                        button.innerHTML = '🙈 Hide';
                        
                        // Auto-hide after 10 seconds for security
                        setTimeout(() => {
                            if (passwordDisplay.textContent !== '••••••••') {
                                hidePassword(adminId);
                            }
                        }, 10000);
                    } else {
                        alert('❌ ' + result.message);
                    }
                }
            } else {
                hidePassword(adminId);
            }
        }
        
        // Hide password
        function hidePassword(adminId) {
            const passwordDisplay = document.getElementById(`password-display-${adminId}`);
            const button = passwordDisplay.nextElementSibling;
            
            passwordDisplay.textContent = '••••••••';
            passwordDisplay.style.background = '#444';
            passwordDisplay.style.color = '#fff';
            button.innerHTML = '👁️ Show';
        }
        
        // Change admin password
        function changeAdminPassword(adminId) {
            // Hide other edit forms first
            document.querySelectorAll('.edit-form.active').forEach(form => {
                form.classList.remove('active');
            });
            
            document.querySelector(`#change-password-${adminId}`).classList.add('active');
        }
        
        // Cancel password change
        function cancelPasswordChange(adminId) {
            document.querySelector(`#change-password-${adminId}`).classList.remove('active');
            // Clear the form
            document.getElementById(`new-password-${adminId}`).value = '';
            document.getElementById(`confirm-password-${adminId}`).value = '';
        }
        
        // Save new password
        function saveNewPassword(adminId) {
            const newPassword = document.getElementById(`new-password-${adminId}`).value;
            const confirmPassword = document.getElementById(`confirm-password-${adminId}`).value;
            
            if (!newPassword || !confirmPassword) {
                alert('Please fill in both password fields.');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match. Please try again.');
                return;
            }
            
            if (confirm('Are you sure you want to change this user\'s password? This will immediately affect their ability to log in.')) {
                const result = securityManager.changeAdminPassword(adminId, newPassword);
                
                if (result.success) {
                    alert('✅ ' + result.message);
                    cancelPasswordChange(adminId);
                    populateUserManagementTab();
                } else {
                    alert('❌ ' + result.message);
                }
            }
        }
        function createAdminAccount(event) {
            event.preventDefault();
            
            const username = document.getElementById('new-admin-username').value.trim();
            const password = document.getElementById('new-admin-password').value.trim();
            
            if (!username || !password) {
                alert('Please fill in all required fields.');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }
            
            // Get selected permissions
            const permissions = [];
            if (document.getElementById('perm-read').checked) permissions.push('read');
            if (document.getElementById('perm-write').checked) permissions.push('write');
            if (document.getElementById('perm-delete').checked) permissions.push('delete');
            if (document.getElementById('perm-settings').checked) permissions.push('settings');
            
            if (permissions.length === 0) {
                alert('Please select at least one permission.');
                return;
            }
            
            const result = securityManager.createAdminAccount(username, password, permissions);
            
            if (result.success) {
                alert('✅ ' + result.message);
                document.getElementById('create-admin-form').reset();
                populateUserManagementTab();
            } else {
                alert('❌ ' + result.message);
            }
        }

        // Edit admin permissions
        function editAdminPermissions(adminId) {
            document.querySelector(`#edit-admin-${adminId}`).classList.add('active');
        }

        // Cancel admin edit
        function cancelAdminEdit(adminId) {
            document.querySelector(`#edit-admin-${adminId}`).classList.remove('active');
        }

        // Save admin permissions
        function saveAdminPermissions(adminId) {
            const permissions = [];
            if (document.getElementById(`edit-perm-read-${adminId}`).checked) permissions.push('read');
            if (document.getElementById(`edit-perm-write-${adminId}`).checked) permissions.push('write');
            if (document.getElementById(`edit-perm-delete-${adminId}`).checked) permissions.push('delete');
            if (document.getElementById(`edit-perm-settings-${adminId}`).checked) permissions.push('settings');
            
            if (permissions.length === 0) {
                alert('Please select at least one permission.');
                return;
            }
            
            const result = securityManager.updateAdminAccount(adminId, permissions);
            
            if (result.success) {
                alert('✅ ' + result.message);
                populateUserManagementTab();
            } else {
                alert('❌ ' + result.message);
            }
        }

        // Delete admin account
        function deleteAdminAccount(adminId) {
            if (confirm('Are you sure you want to delete this admin account? This action cannot be undone.')) {
                const result = securityManager.deleteAdminAccount(adminId);
                
                if (result.success) {
                    alert('✅ ' + result.message);
                    populateUserManagementTab();
                } else {
                    alert('❌ ' + result.message);
                }
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                isLoggedIn = false;
                sessionToken = null;
                currentAdminUser = null;
                securityManager.currentUser = null;
                localStorage.removeItem('admin_session_token');
                showPage('intro');
                document.getElementById('admin-username').value = '';
                document.getElementById('admin-password').value = '';
                alert('You have been logged out successfully.');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Libby\'s Poetry Garden - Secure Version Initializing...');
            
            // Check for existing session
            if (sessionToken && securityManager.validateSession(sessionToken)) {
                console.log('🔐 Valid session found');
                isLoggedIn = true;
                // Try to restore current user info from securityManager
                if (securityManager.currentUser) {
                    currentAdminUser = securityManager.currentUser;
                }
            }
            
            // Load data from storage
            loadFromLocalStorage(); // Load localStorage first (immediate)
            
            if (firebaseEnabled) {
                console.log('☁️ Loading data from Firebase...');
                const firebaseLoaded = await loadFromFirebase();
                if (firebaseLoaded) {
                    setupFirebaseListeners(); // Set up real-time sync
                }
            }
            
            // Update announcement and intro text if loaded
            document.getElementById('announcement').textContent = currentAnnouncement;
            document.getElementById('intro-text').textContent = currentIntroText;
            
            // Set up form event listeners
            document.getElementById('poetry-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const authorName = document.getElementById('poet-name').value;
                
                if (cooldownUsers[authorName] && Date.now() < cooldownUsers[authorName]) {
                    alert('Please wait before submitting another poem.');
                    return;
                }
                
                let imageData = null;
                const imageFile = document.getElementById('poem-image').files[0];
                if (imageFile) {
                    imageData = await convertImageToBase64(imageFile);
                }
                
                const newEntry = {
                    id: Date.now(),
                    title: document.getElementById('poem-title').value,
                    content: document.getElementById('poem-content').value,
                    author: authorName,
                    image: imageData,
                    isAdmin: false
                };
                
                userSubmissions.push(newEntry);
                cooldownUsers[authorName] = Date.now() + (5 * 60 * 1000);
                latestPoetryId = newEntry.id;
                
                // Save to both storage systems
                await saveData('userSubmissions', newEntry);
                
                this.reset();
                document.getElementById('poem-image-preview').innerHTML = '';
                
                showNotification(
                    'New Poetry Added! 🌸',
                    `"${newEntry.title}" by ${newEntry.author} has been added to the Community Collection`,
                    newEntry.id
                );
                
                alert('Your poetry has been submitted successfully! 🌸\nYou can view it in the Community Poetry book.');
                checkCooldown();
            });

            // Enhanced admin login with security manager
            document.getElementById('admin-login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                
                const authResult = securityManager.validateCredentials(username, password);
                
                if (authResult.success) {
                    isLoggedIn = true;
                    currentAdminUser = authResult.user;
                    sessionToken = securityManager.generateSessionToken();
                    localStorage.setItem('admin_session_token', sessionToken);
                    
                    const roleMessage = currentAdminUser.role === 'super_admin' ? 'Primary Admin' : 'Admin';
                    alert(`✅ Login successful! Welcome ${roleMessage}: ${currentAdminUser.username}`);
                    console.log('🔐 Admin authenticated successfully:', currentAdminUser);
                    showPage('admin-panel');
                } else {
                    alert('❌ ' + authResult.message);
                    
                    if (authResult.remainingTime) {
                        const minutes = authResult.remainingTime;
                        alert(`⏰ Account locked for ${minutes} more minutes.`);
                    }
                    
                    // Clear the form
                    document.getElementById('admin-username').value = '';
                    document.getElementById('admin-password').value = '';
                }
            });

            // Create admin form event listener
            document.getElementById('create-admin-form').addEventListener('submit', createAdminAccount);
            
            // Add event listeners for permission checkboxes
            ['perm-read', 'perm-write', 'perm-delete', 'perm-settings'].forEach(id => {
                document.getElementById(id).addEventListener('change', updatePermissionSummary);
            });
            
            // Initialize permission summary
            updatePermissionSummary();

            document.getElementById('admin-poetry-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                let imageData = null;
                const imageFile = document.getElementById('admin-poem-image').files[0];
                if (imageFile) {
                    imageData = await convertImageToBase64(imageFile);
                }
                
                const newEntry = {
                    id: Date.now(),
                    title: document.getElementById('admin-poem-title').value,
                    content: document.getElementById('admin-poem-content').value,
                    author: document.getElementById('admin-poem-author').value,
                    image: imageData,
                    isAdmin: true
                };
                
                poetryEntries.push(newEntry);
                this.reset();
                document.getElementById('admin-poem-image-preview').innerHTML = '';
                
                // Save to both storage systems
                await saveData('poetryEntries', newEntry);
                
                // Refresh the tab and stats
                populateLibbyPoetryTab();
                updateAdminStats();
                alert('Poetry entry added successfully!');
            });

            document.getElementById('shop-item-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                let imageData = document.getElementById('item-image').value;
                const imageFile = document.getElementById('item-image-file').files[0];
                if (imageFile) {
                    imageData = await convertImageToBase64(imageFile);
                } else if (!imageData) {
                    imageData = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'%3E%3Crect fill='%23f0f0f0' width='300' height='200'/%3E%3Ctext x='50%' y='50%' text-anchor='middle' fill='%23666' font-size='14'%3ENo Image%3C/text%3E%3C/svg%3E";
                }
                
                const newItem = {
                    id: Date.now(),
                    name: document.getElementById('item-name').value,
                    description: document.getElementById('item-description').value,
                    price: document.getElementById('item-price').value,
                    image: imageData,
                    link: document.getElementById('item-link').value
                };
                
                shopItems.push(newItem);
                this.reset();
                document.getElementById('item-image-preview').innerHTML = '';
                
                // Save to both storage systems
                await saveData('shopItems', newItem);
                
                // Refresh the tab and stats
                populateShopItemsTab();
                updateAdminStats();
                alert('Shop item added successfully!');
            });

            // Image preview event listeners
            document.getElementById('poem-image').addEventListener('change', function(e) {
                handleImagePreview(e, 'poem-image-preview');
            });

            document.getElementById('item-image-file').addEventListener('change', function(e) {
                handleImagePreview(e, 'item-image-preview');
            });

            document.getElementById('admin-poem-image').addEventListener('change', function(e) {
                handleImagePreview(e, 'admin-poem-image-preview');
            });

            document.getElementById('poet-name').addEventListener('input', checkCooldown);
            
            // Initialize floating elements positions
            const leaves = document.querySelectorAll('.floating-leaf');
            leaves.forEach((leaf, index) => {
                // Randomize animation duration for more natural movement
                const duration = 6 + Math.random() * 4; // 6-10 seconds
                leaf.style.animationDuration = duration + 's';
                
                // Add slight random positioning variations
                const currentLeft = parseFloat(leaf.style.left);
                const currentTop = parseFloat(leaf.style.top);
                leaf.style.left = (currentLeft + (Math.random() - 0.5) * 10) + '%';
                leaf.style.top = (currentTop + (Math.random() - 0.5) * 10) + '%';
            });

            console.log('✅ Secure initialization complete!');
            console.log('🔒 Security features active');
        });
    </script>
</body>
</html> Edit Poetry Entry</h4>
                        <div class="form-group">
                            <label>Title:</label>
                            <input type="text" id="edit-title-${entry.id}" value="${entry.title}">
                        </div>
                        <div class="form-group">
                            <label>Author:</label>
                            <input type="text" id="edit-author-${entry.id}" value="${entry.author}">
                        </div>
                        <div class="form-group">
                            <label>Content:</label>
                            <textarea id="edit-content-${entry.id}" style="height: 120px;">${entry.content}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Change Image (optional):</label>
                            <input type="file" id="edit-image-${entry.id}" accept="image/*">
                            <div id="edit-image-preview-${entry.id}" class="image-preview">
                                ${entry.image ? `<img src="${entry.image}" alt="Current image"><button type="button" class="remove-image-btn" onclick="removeCurrentImage(${entry.id})">Remove Current Image</button>` : ''}
                            </div>
                        </div>
                        <div class="admin-buttons">
                            <button class="admin-btn save" onclick="savePoetryEdit(${entry.id}, ${entry.isAdmin})">💾 Save Changes</button>
                            <button class="admin-btn cancel" onclick="cancelPoetryEdit(${entry.id})">❌ Cancel</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Populate Community Poetry tab
        function populateCommunityPoetryTab() {
            const container = document.getElementById('admin-community-poetry-list');
            
            if (userSubmissions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 2rem;">No community submissions yet. Encourage users to share their poetry!</p>';
                return;
            }
            
            container.innerHTML = userSubmissions.map(entry => `
                <div class="admin-item-card" id="poetry-${entry.id}">
                    <div class="poetry-display" id="display-${entry.id}">
                        <div class="admin-item-header">
                            <div>
                                <h5 class="admin-item-title">${entry.title}</h5>
                                <div class="admin-item-author">by ${entry.author} (Community)</div>
                            </div>
                            ${entry.image ? `<img src="${entry.image}" alt="${entry.title}" class="admin-item-image">` : ''}
                        </div>
                        <div class="admin-item-content">${entry.content.substring(0, 150)}${entry.content.length > 150 ? '...' : ''}</div>
                        <div class="admin-buttons">
                            <button class="admin-btn edit" onclick="editPoetry(${entry.id}, ${entry.isAdmin})">✏️ Edit</button>
                            <button class="admin-btn delete" onclick="deletePoetry(${entry.id}, ${entry.isAdmin})">🗑️ Delete</button>
                        </div>
                    </div>
                    
                    <div class="edit-form" id="edit-${entry.id}">
                        <h4>✏️